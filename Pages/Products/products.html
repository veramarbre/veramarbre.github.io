<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Products - VERA MARBRE™</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.6/lottie.min.js"></script>
    <style>
      .loading-spinner {
        display: none;
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #3498db;
        width: 120px;
        height: 120px;
        animation: spin 2s linear infinite;
        margin: auto;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header role="banner">
      <div class="container">
        <div class="menu-icon" aria-label="Menu">
          <i class="fas fa-bars"></i>
        </div>
        <div class="logo">
          <a href="../index.html" aria-label="STONE™ Homepage">
            <h1>VERA MARBRE™</h1>
          </a>
        </div>
        <nav role="navigation" aria-label="Main Navigation">
          <ul>
            <li><a href="../index.html" data-i18n="home">Home</a></li>
            <li>
              <a href="index.html#products" data-i18n="products">Products</a>
            </li>
            <li><a href="index.html#about" data-i18n="about">About</a></li>
            <li>
              <a href="index.html#contact" data-i18n="contact">Contact</a>
            </li>
          </ul>
        </nav>
        <button id="signOutButton" style="display: none;" aria-label="Sign Out">Sign Out</button>
      </div>
    </header>

    <!-- Main Content -->
    <main role="main">
      <section class="products-section">
        <div class="container">
          <h2 data-i18n="ourProducts">Our Products</h2>
          <div class="search-box">
            <input
              type="text"
              placeholder="Search products..."
              aria-label="Search products"
              id="searchInput"
            />
            <button aria-label="Search" id="searchButton">
              <i class="fas fa-search"></i>
            </button>
          </div>
          <div class="loading-spinner" id="loadingSpinner"></div>
          <div class="product-grid" id="productGrid">
            <!-- Products will be dynamically loaded here -->
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer role="contentinfo">
      <div class="container">
        <p>
          © 2023 VERA MARBRE™. All rights reserved. |
          <a href="privacy.html" aria-label="Privacy Policy">Privacy Policy</a>
        </p>
      </div>
    </footer>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDGthkRpERFT4j4Tw9p3mMII9SHVtfTvOo",
  authDomain: "vera-marbre.firebaseapp.com",
  databaseURL: "https://vera-marbre-default-rtdb.firebaseio.com",
  projectId: "vera-marbre",
  storageBucket: "vera-marbre.appspot.com",
  messagingSenderId: "58963574008",
  appId: "1:58963574008:web:39353c784e3a8b031d0f0d",
  measurementId: "G-KGP6L8PG9M",
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const database = getDatabase(app);
const auth = getAuth(app);

// Fetch products from Firebase Realtime Database
async function fetchProducts() {
  const loadingSpinner = document.getElementById("loadingSpinner");
  loadingSpinner.style.display = "block"; // Show loading spinner

  const dbRef = ref(database, "products");
  const snapshot = await get(dbRef);
  if (snapshot.exists()) {
    const products = snapshot.val();
    renderProducts(products);
    setupSearch(products);
  } else {
    console.log("No data available");
  }

  loadingSpinner.style.display = "none"; // Hide loading spinner
}

// Render products in the HTML
function renderProducts(products) {
  const productGrid = document.getElementById("productGrid");
  productGrid.innerHTML = ""; // Clear existing content
  for (const key in products) {
    if (products.hasOwnProperty(key)) {
      const product = products[key];
      const productDiv = document.createElement("div");
      productDiv.classList.add("product");
      productDiv.innerHTML = `
        <img src="${product.image_url}" alt="${product.description}" loading="lazy" />
        <h3>${product.name}</h3>
      `;
      productGrid.appendChild(productDiv);
    }
  }
}

// Setup search functionality
function setupSearch(products) {
  const searchInput = document.getElementById("searchInput");

  searchInput.addEventListener("input", () => {
    const query = searchInput.value.toLowerCase();
    const filteredProducts = {};
    for (const key in products) {
      if (products.hasOwnProperty(key)) {
        const product = products[key];
        if (product.name.toLowerCase().includes(query) || product.description.toLowerCase().includes(query)) {
          filteredProducts[key] = product;
        }
      }
    }
    renderProducts(filteredProducts);
  });
}

// Fetch and render products on page load
fetchProducts();

// Handle sign out
const signOutButton = document.getElementById('signOutButton');
signOutButton.addEventListener('click', async () => {
  try {
    await signOut(auth);
    alert('Signed out successfully!');
    signOutButton.style.display = 'none';
    window.location.href = '/login.html'; // Redirect to login page after sign out
  } catch (error) {
    alert('Error signing out: ' + error.message);
  }
});

// Check auth state and show/hide sign out button
onAuthStateChanged(auth, (user) => {
  if (user) {
    signOutButton.style.display = 'block';
    console.log('User is signed in:', user);
    // You can redirect to the admin panel or show specific content
    window.location.href = '/admin-panel.html'; // Example redirect
  } else {
    signOutButton.style.display = 'none';
    console.log('No user is signed in');
    // You can redirect to the login page or show a message
    window.location.href = '/login.html'; // Example redirect
  }
});

      
    </script>

    <!-- External JS file -->
    <script src="script.js"></script>
  </body>
</html>
